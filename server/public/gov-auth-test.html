<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Gov Portal – Auth Test</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f6f8;
      padding: 30px;
    }

    h1 {
      margin-bottom: 10px;
    }

    .box {
      background: #fff;
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 6px;
      max-width: 400px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }

    input {
      width: 100%;
      padding: 8px;
      margin-top: 8px;
    }

    button {
      padding: 8px;
      margin-top: 10px;
      width: 100%;
      cursor: pointer;
    }

    pre {
      background: #eee;
      padding: 10px;
      overflow-x: auto;
    }
  </style>
</head>
<body>

<h1>Government Portal – Auth API Tester</h1>

<div class="box">
  <h3>Register</h3>
  <input id="reg-username" placeholder="Username" />
  <input id="reg-password" type="password" placeholder="Password" />
  <button onclick="register()">Register</button>
</div>

<div class="box">
  <h3>Login</h3>
  <input id="login-username" placeholder="Username" />
  <input id="login-password" type="password" placeholder="Password" />
  <button onclick="login()">Login</button>
</div>

<div class="box">
  <h3>Refresh Token</h3>
  <button onclick="refreshToken()">Refresh</button>
</div>

<div class="box">
  <h3>Logout</h3>
  <button onclick="logout()">Logout</button>
</div>

<h3>Response</h3>
<pre id="output">No response yet</pre>

<script>
const API = "/gov";
let refreshTokenValue = null;

/* =====================
   HELPERS
   ===================== */
function show(data) {
  document.getElementById("output").textContent =
    JSON.stringify(data, null, 2);
}

/* =====================
   REGISTER
   ===================== */
async function register() {
  const username = document.getElementById("reg-username").value;
  const password = document.getElementById("reg-password").value;

  const res = await fetch(`${API}/register`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ username, password })
  });

  show(await res.json());
}

/* =====================
   LOGIN
   ===================== */
async function login() {
  const username = document.getElementById("login-username").value;
  const password = document.getElementById("login-password").value;

  const res = await fetch(`${API}/login`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ username, password })
  });

  const data = await res.json();
  refreshTokenValue = data.refreshToken || null;

  show(data);
}

/* =====================
   REFRESH TOKEN
   ===================== */
async function refreshToken() {
  if (!refreshTokenValue) {
    show({ error: "Login first to get refresh token" });
    return;
  }

  const res = await fetch(`${API}/refreshToken`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ refreshToken: refreshTokenValue })
  });

  const data = await res.json();
  refreshTokenValue = data.refreshToken || refreshTokenValue;

  show(data);
}

/* =====================
   LOGOUT
   ===================== */
async function logout() {
  if (!refreshTokenValue) {
    show({ error: "No refresh token available" });
    return;
  }

  const res = await fetch(`${API}/logout`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ refreshToken: refreshTokenValue })
  });

  refreshTokenValue = null;
  show(await res.json());
}
</script>

</body>
</html>
